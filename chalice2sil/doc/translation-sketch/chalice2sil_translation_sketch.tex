% !TEX TS-program = xelatex
% !TEX encoding = UTF-8

\documentclass[11pt]{article} % use larger type; default would be 10pt

\usepackage[fleqn]{amsmath}
\usepackage{amsthm,amsfonts}
\usepackage{amssymb} % Must be included BEFORE unicode!!!
\usepackage{fontspec} % Font selection for XeLaTeX; see fontspec.pdf for documentation
\defaultfontfeatures{Mapping=tex-text} % to support TeX conventions like ``---''
\usepackage{xunicode} % Unicode support for LaTeX character names (accents, European chars, etc)
\usepackage{xltxtra} % Extra customizations for XeLaTeX
\usepackage[math-style=ISO]{unicode-math}
%\usepackage{multicol}


\setmainfont{Cambria} % set the main body font (\textrm), assumes Charis SIL is installed
\setsansfont{Calibri}
\setmonofont{Consolas}
\setmathfont{Cambria Math}

% other LaTeX packages.....
\usepackage{savetrees}
\usepackage{fullpage}
%\usepackage{bussproofs}
\usepackage{fancyhdr}
\usepackage{listings}
\usepackage{syntax}
\usepackage{color}
\usepackage{float}
\newfloat{grammarListingFloat}{hbpt}{gl.aux}
\floatname{grammarListingFloat}{Listing}
\newenvironment{grammarListing}{\begin{grammarListingFloat}\synshorts}{\synshortsoff\end{grammarListingFloat}}

% =====================================================
% ===== META INFORMATION ==============================
% =====================================================

\newcommand{\metaSemester}{HS11}
\newcommand{\metaCourseFull}{Translating Chalice into SIL}
\newcommand{\metaCourseShort}{Chalice2SIL}
\newcommand{\metaCourse}{\metaCourseFull{} (\metaCourseShort)}
\newcommand{\metaSectionPrefix}{}
\newcommand{\metaAuthor}{Christian Klauser}
\newcommand{\metaAuthorNethz}{klauserc}
\newcommand{\metaAuthorLegi}{08-919-490}

\newcommand{\metaTitle}{Translation Sketch}

% =====================================================
% =====================================================

\pagestyle{fancy}%
\renewcommand{\headrulewidth}{1pt}%
\renewcommand{\footrulewidth}{0pt}%
%\setlength{\headheight}{7pt}%
\setlength{\headsep}{28pt}
\setlength{\footskip}{10pt}%
\fancyhead[L]{\metaCourse}%
\fancyhead[R]{\metaAuthor,\ \ \today}%
\fancyfoot[C]{\thepage}%

\usepackage{graphicx} % support the \includegraphics command and options
%\usepackage{pdflscape}

%=========================================

\newcommand{\abs}[1]{{\left\lvert#1\right\rvert}}
\newcommand{\norm}[1]{{\left\lVert#1\right\rVert}}
\newcommand{\setw}[2]{\ensuremath{\left\{#1\:\middle|\:#2\right\}}}
\newcommand{\albool}{\ensuremath{\{0,1\}}}
\newcommand{\alab}{\ensuremath{\{a,b\}}}
\newcommand{\NN}{\ensuremath{\mathbb{N}}}
\newcommand{\RR}{\ensuremath{\mathbb{R}}}
\newcommand{\ZZ}{\ensuremath{\mathbb{Z}}}
\newcommand{\QQ}{\ensuremath{\mathbb{Q}}}
\newcommand{\CC}{\ensuremath{\mathbb{C}}}
\newcommand{\KK}{\ensuremath{\mathbb{K}}}
\newcommand{\MM}{\ensuremath{\mathbb{M}}}
\newcommand{\E}[1]{\ensuremath{\mathbf{E}\left[#1\right]}}
\newcommand{\ECond}[2]{\ensuremath{\mathbf{E}\left[#1\:\middle|\:#2\right]}}
\renewcommand{\Pr}[1]{\ensuremath{\mathbf{Pr}\left[#1\right]}}
\newcommand{\Prs}[2]{\ensuremath{\mathbf{Pr}_{#2}\left[#1\right]}}
\newcommand{\PrCond}[2]{\ensuremath{\mathbf{Pr}\left[#1\:\middle|\:#2\right]}}

\newcommand{\entails}{\ensuremath{\vdash\ }}
\renewcommand{\implies}{\ensuremath{\ \rightarrow\ }}

%=========================================
%		Document-specific commands

\newcommand{\ldbrack}{⟦}
\newcommand{\rdbrack}{⟧}
\newcommand{\ch}[1]{\left\ldbrack{}#1\right\rdbrack_\text{Ch}}
\newcommand{\sil}[1]{\left\ldbrack{}#1\right\rdbrack_\text{SIL}}

\newcommand{\Chalice}{Chalice}
\newcommand{\SIL}{SIL}
\newcommand{\ct}[1]{\ensuremath{\text{\texttt{#1}}\ }}
\newcommand{\ctw}[1]{\ensuremath{\ \ \text{\texttt{#1}}\ \ }}
\newcommand{\ctn}[1]{\ensuremath{\text{\texttt{#1}}}}
\newcommand{\bt}{\lstinline!::!}

%=========================================

\usepackage[parfill]{parskip} 
\usepackage{titlesec}
%\titleformat{\section}[display]{\normalfont\Large\bfseries}{Problem \thesection:}{1em}{}
\titleformat{\section}{\normalfont\Large\bfseries\sffamily}{\metaSectionPrefix \thesection\ }{0.5em}{}
\titleformat{\subsection}{\normalfont\large\bfseries\sffamily}{\thesubsection}{0.5em}{}
\titleformat{\subsubsection}{\normalfont\bfseries\sffamily}{\thesubsubsection}{0.4em}{}
\renewcommand{\thesection}{\arabic{section}}
\renewcommand{\thesubsection}{(\alph{subsection})}
\renewcommand{\thesubsubsection}{(\roman{subsubsection})}

%=========================================

\title{\metaTitle}
\author{\metaAuthor}
%\date{} % Activate to display a given date or no date (if empty),
         % otherwise the current date is printed 

\begin{document}
{\LARGE \bf\sffamily \metaTitle}

\section{Expressions}
$E$ translates a \Chalice{} expression into an equivalent \SIL{} expression. Given an scoped identifier $i$, $ρ(i)$ denotes a globally unique identifier. E.g., $ρ(\ctn{someField}) = \ct{SomeClass\bt{}someField}$

\begin{align}
	E\ch{e_1 \ct{?} e_2 \ct{:} e_3} &= \sil{E\left(e_1\right) \ctw{?} E\left(e_2\right) \ctw{:} E\left(e_3\right)} \\
	E\ch{e_1 \ct{==} e_2} &= \sil{\ctn{==}\left(E\left(e_1\right), E\left(e_2\right)\right)} \\
	E\ch{e_1 \ct{!=} e_2} &= \sil{\ctn{!=}\left(E\left(e_1\right), E\left(e_2\right)\right)} \\
	E\ch{e_1 \ct{<} e_2} &= \sil{\ctn{<}\left(E\left(e_1\right), E\left(e_2\right)\right)} \\
	E\ch{e_1 \ct{<=} e_2} &= \sil{\ctn{<=}\left(E\left(e_1\right), E\left(e_2\right)\right)} \\
	E\ch{e_1 \ct{>=} e_2} &= \sil{\ctn{>=}\left(E\left(e_1\right), E\left(e_2\right)\right)} \\
	E\ch{e_1 \ct{>} e_2} &= \sil{\ctn{>}\left(E\left(e_1\right), E\left(e_2\right)\right)} \\
	E\ch{e_1 \ct{<<} e_2} &= \ct{/* lock below ??? */} \\
	E\ch{e_1 \ctw{in} e_2} &= \sil{\ctn{in}\left(E\left(e_1\right), E\left(e_2\right)\right)} \\
	E\ch{e_1 \ctw{!in} e_2} &= E\ch{\ctn{!}\left(e_1 \ctw{in} e_2\right)} \\
	E\ch{e_1 \ct{+} e_2} &= \sil{\ctn{+}\left(E\left(e_1\right), E\left(e_2\right)\right)} \\
	E\ch{e_1 \ct{-} e_2} &= \sil{\ctn{-}\left(E\left(e_1\right), E\left(e_2\right)\right)} \\
	E\ch{e_1 \ct{*} e_2} &= \sil{\ctn{*}\left(E\left(e_1\right), E\left(e_2\right)\right)} \\
	E\ch{e_1 \ct{/} e_2} &= \sil{\ctn{/}\left(E\left(e_1\right), E\left(e_2\right)\right)} \\
	E\ch{e_1 \ct{\%} e_2} &= \sil{\ctn{\%}\left(E\left(e_1\right), E\left(e_2\right)\right)} \\
	E\ch{\ct{!} e} &= \sil{\ctn{!}\left(E\left(e\right)\right)} \\
	E\ch{\ct{-} e} &= \sil{\ctn{-}\left(E\left(e\right)\right)} \\
	E\ch{e_1\ct{[}e_2\ct{]}} &= \sil{\ctn{at}\left(E\left(e_1\right), E\left(e_2\right)\right)} \\
	E\ch{e_1\ct{[}e_2\ct{..]}} &= \sil{\ctn{drop}\left(E\left(e_1\right), E\left(e_2\right)\right)} \\
	E\ch{e_1\ct{[..}e_2\ct{]}} &= \sil{\ctn{take}\left(E\left(e_1\right), E\left(e_2\right)\right)} \\
	E\ch{e_1\ctn{.}id} &= \sil{E\left(e_1\right)\ctn{.}id} \\
	E\ch{e_1\ctn{.}id\ctn{(}e\ldots\ctn{)}} &= \sil{ρ\!\left(id\right)\!\left(E\left(e_1\right), E\left(e\ldots\right)\right)}  \\
	%E\ch{e_1\ctn{.acquire} e_2} &= \ct{/* Eval(AcquireState(e_1), e_2) */} \\
	%E\ch{e_1\ctn{.release} e_2} &= \ct{/* Eval(ReleaseState(e_1), e_2) */} \\
	%E\ch{e_1\ct{.fork}\ \ {id}_1\ctn{.}{id}_2\ldots\ctn{.}{id}_n(e\ldots)\ \ e_2} &= \ct{/* Parser.scala 466 */}
	E\ch{\ctn{true}} &= \sil{\ctn{true}} \\
	E\ch{\ctn{false}} &= \sil{\ctn{false}} \\
	E\ch{\ctn{null}} &= \sil{\ctn{null}} \\
	E\ch{\ctn{this}} &= \ctn{/* ??? */} \\
	E\ch{x} &= \sil{x}\qquad\text{where $x$ is a numeric literal}
\end{align}

\end{document}
