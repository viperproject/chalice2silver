/* The following program used to result in Syxc throwing an error when merging
 * heaps. The reason is as follows:
 *  - The heap merger throws an error if two chunks are supposed to be merged
 *    where at least one is neither a field nor a predicate chunk
 *  - In the example below, the state is inconsistent after the loop has been
 *    symbolically executed (due to the guard)
 *  - Hence, a subsequent merging operation tries to merge two TokenChunks
 *    because their receivers are equivalent (due to the inconsistent state),
 *    which results in the aforementioned error.
 *//*
 * Verifying with --smoke did not yield such an error.
 *
 * For now I simply fixed it by performing a smoke check before a heap merge
 * is started.
 *
 * A more general solution might be to only include field and predicate chunks
 * in the merger, thus preventing the issue right from the start.
 */
 
class A {
	method m1() {}
	method m2() {}
}

class Test {
	method test() {
		var a: A := new A
		
		fork a.m1()
		fork a.m2()
		
		while (true)
      invariant rd(a.mu)
    {}
	}
}