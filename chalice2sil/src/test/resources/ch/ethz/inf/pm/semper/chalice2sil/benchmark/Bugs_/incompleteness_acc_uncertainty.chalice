/* This incompleteness has been discovered by Alex.
 *
 * The problem is that the pure condition "b ? x == y : x == z" is turned into
 * a corresponding Z3 assertion, thus no branching is done and b is not
 * explicitly fixed to be either true or false.
 * This disallows Syxc to compress the heap, hence it does not know that it
 * has full access to x.f regardless of the value of b.
 *
 * If Syxc is run with "--branchOverPureConditionals true" then there is
 * no incompleteness and the subsequent assertion correctly fails.
 */

class Cell {
  var f: int
}

class Test {
  method test(b: bool, x: Cell, y: Cell, z: Cell)
    requires b ? x == y : x == z
    requires acc(x.f, 50)
    requires acc(y.f, 50)
    requires acc(z.f, 50)
  {
    call consumeW(x) /* @Fails */
    assert rd(y.f)
  }
  
  method consumeW(x: Cell)
    requires acc(x.f)
  {}
}