class Main{
    var f : int;
    method work()
        requires acc(f)
        ensures acc(f)
    {
    }

    method main()
        requires acc(f)
        ensures acc(f)
    {
        f := 3;
        fork tk := work();
        call client(tk, this);
    }

    method client(tk : token<Main.work>, obj : Main)
        requires acc(tk.joinable) && tk.joinable
        requires eval(tk.fork this.work(), this == obj)
        ensures acc(obj.f)
    {
        join tk;
    }
}